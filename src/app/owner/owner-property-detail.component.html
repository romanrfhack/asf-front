<div *ngIf="prop" class="space-y-4">
  <div class="bg-white rounded-xl shadow p-4">
    <div class="flex items-start justify-between">
      <div>
        <div class="text-lg font-semibold">{{ prop.name }}</div>
        <div class="text-xs text-slate-500">Code: {{ prop.code }} • Campus: {{ prop.campus || '-' }}</div>
      </div>
      <button (click)="exportCsv()" class="px-3 py-1 rounded border text-sm">Export CSV</button>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
      <div class="rounded border p-3">
        <div class="text-[10px] text-slate-500">Units</div>
        <div class="text-xl font-semibold">{{ unitsCount() }}</div>
      </div>
      <div class="rounded border p-3">
        <div class="text-[10px] text-slate-500">Open Tickets</div>
        <div class="text-xl font-semibold">{{ openTickets() }}</div>
      </div>
      <div class="rounded border p-3">
        <div class="text-[10px] text-slate-500">OPEX Total</div>
        <div class="text-xl font-semibold">{{ kpi().opex | currency }}</div>
      </div>
      <div class="rounded border p-3">
        <div class="text-[10px] text-slate-500">CAPEX Total</div>
        <div class="text-xl font-semibold">{{ kpi().capex | currency }}</div>
      </div>
    </div>
  </div>

  <!-- Add expense -->
  <div class="bg-white rounded-xl shadow p-4">
    <div class="font-medium mb-2">Add Expense</div>
    <div class="grid gap-2 md:grid-cols-6">
      <input [(ngModel)]="date" type="date" class="rounded border px-3 py-2" />
      <select [(ngModel)]="type" class="rounded border px-3 py-2">
        <option value="opex">OPEX</option>
        <option value="capex">CAPEX</option>
      </select>
      <input [(ngModel)]="category" placeholder="Category" class="rounded border px-3 py-2" />
      <input [(ngModel)]="amount" type="number" step="0.01" placeholder="Amount" class="rounded border px-3 py-2" />
      <input [(ngModel)]="description" placeholder="Description (optional)" class="rounded border px-3 py-2 md:col-span-2" />
    </div>
    <div class="pt-2">
      <button (click)="addExpense()" class="px-4 py-2 rounded-lg bg-slate-900 text-white">Add</button>
    </div>
  </div>

  <!-- Expenses table -->
  <div class="bg-white rounded-xl shadow p-4">
    <div class="flex items-center justify-between">
      <div class="font-medium">Expenses</div>
      <div class="flex gap-2 text-sm">
        <button class="px-2 py-1 rounded border" (click)="filter='all'">All</button>
        <button class="px-2 py-1 rounded border" (click)="filter='opex'">OPEX</button>
        <button class="px-2 py-1 rounded border" (click)="filter='capex'">CAPEX</button>
      </div>
    </div>
    <div class="mt-3 grid gap-2">
      <div *ngFor="let e of expenses" class="rounded border p-3">
        <div class="flex items-start justify-between">
          <div>
            <div class="text-sm font-medium">{{ e.type | uppercase }} • {{ e.category }}</div>
            <div class="text-xs text-slate-500">{{ e.date | date:'mediumDate' }} — {{ e.description || '-' }}</div>
            <div class="text-sm font-semibold mt-1">{{ e.amount | currency }}</div>
          </div>
          <button (click)="removeExpense(e.id)" class="text-sm underline">Delete</button>
        </div>
        <div class="mt-2">
          <label class="text-xs text-slate-500">Add evidence</label>
          <input type="file" (change)="onEvidenceSelect($event, e.id)" accept="image/*" multiple class="block mt-1 text-sm" />
          <div class="grid grid-cols-3 gap-2 mt-2">
            <img *ngFor="let p of e.evidence || []" [src]="p" class="w-full h-20 object-cover rounded" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
